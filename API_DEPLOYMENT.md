# Инструкция по деплою API и настройке для GitHub Pages

## Проблема

GitHub Pages - это статический хостинг, который не поддерживает PHP. Поэтому API endpoints на PHP не могут работать на GitHub Pages напрямую.

## Решение

API должен быть размещен на отдельном сервере с поддержкой PHP и MySQL, доступном по публичному URL.

## Варианты деплоя API

### Вариант 1: Использование платного хостинга (рекомендуется для продакшена)

1. **Выберите хостинг с поддержкой PHP и MySQL:**
   - [000webhost.com](https://www.000webhost.com) (бесплатный)
   - [InfinityFree](https://www.infinityfree.net) (бесплатный)
   - [Hostinger](https://www.hostinger.com) (платный, от $2/месяц)
   - [Timeweb](https://timeweb.com) (платный)

2. **Загрузите API файлы:**
   - Создайте папку `api` на хостинге
   - Загрузите все файлы из папки `api/` проекта:
     - `config.php`
     - `categories.php`
     - `products.php`
     - `orders.php`
     - `users.php`

3. **Настройте базу данных:**
   - Создайте базу данных на хостинге
   - Импортируйте структуру БД из `database_schema.sql`
   - Обновите `config.php` с новыми данными подключения:
     ```php
     define('DB_HOST', 'localhost'); // или IP сервера БД
     define('DB_NAME', 'your_db_name');
     define('DB_USER', 'your_db_user');
     define('DB_PASS', 'your_db_password');
     ```

4. **Импортируйте данные:**
   - Загрузите данные товаров через `import_products.php`

5. **Настройте CORS (если нужно):**
   - В `config.php` уже настроен CORS для всех доменов
   - При необходимости ограничьте доступ только к вашему домену GitHub Pages

### Вариант 2: Использование локального сервера с туннелингом (для тестирования)

**Внимание:** Этот вариант подходит только для тестирования, не для продакшена.

1. **Используйте ngrok или аналогичный сервис:**
   ```bash
   # Установите ngrok
   # Затем запустите туннель к вашему XAMPP:
   ngrok http 80
   ```
   
2. **Получите публичный URL** (например: `https://abc123.ngrok.io`)

3. **Настройте в index.html:**
   ```html
   <script>
     window.API_URL = 'https://abc123.ngrok.io/pc_salon';
   </script>
   ```

### Вариант 3: VPS сервер (для продвинутых пользователей)

1. Арендуйте VPS (например, DigitalOcean, AWS, Hetzner)
2. Установите Apache/Nginx, PHP, MySQL
3. Загрузите API файлы
4. Настройте базу данных
5. Настройте домен и SSL сертификат

## Настройка фронтенда для работы с API

После деплоя API на публичный сервер:

1. **Откройте `index.html`**

2. **Найдите блок с настройкой API** (около строки 1049)

3. **Раскомментируйте и укажите ваш публичный URL:**
   ```html
   <script>
     window.API_URL = 'https://your-api-domain.com'; // Замените на ваш URL
   </script>
   ```

4. **Сохраните и закоммитьте изменения:**
   ```bash
   git add index.html
   git commit -m "Configure API URL for production"
   git push
   ```

## Проверка работы

1. **Откройте сайт на GitHub Pages**
2. **Откройте консоль браузера (F12)**
3. **Попробуйте оформить заказ**
4. **Проверьте:**
   - Нет ли ошибок в консоли
   - Создается ли заказ в базе данных
   - Отображается ли номер заказа после оформления

## Структура API URL

API модуль автоматически добавляет `/api` к указанному URL:

- Если указан: `https://your-domain.com`
- API будет доступен по: `https://your-domain.com/api/categories.php`

Или можно указать полный путь:
- Если указан: `https://your-domain.com/api`
- API будет доступен по: `https://your-domain.com/api/categories.php`

## Важные замечания

1. **Безопасность:**
   - Не храните credentials в публичном репозитории
   - Используйте переменные окружения на сервере
   - Ограничьте CORS только необходимыми доменами

2. **База данных:**
   - Убедитесь, что MySQL доступен извне (если БД на другом сервере)
   - Настройте firewall правильно
   - Используйте безопасные пароли

3. **Тестирование:**
   - Всегда тестируйте API перед деплоем на продакшен
   - Проверяйте работу всех endpoints
   - Тестируйте создание заказов

## Текущая настройка

По умолчанию для локальной разработки используется:
- `http://localhost/pc_salon/api` (если открыто на localhost)
- Относительный путь `/api` (если открыто на GitHub Pages, но без настройки `window.API_URL` не будет работать)

## Пример конфигурации для разных окружений

### Локальная разработка:
```html
<!-- Ничего не нужно, используется автоматически localhost -->
```

### GitHub Pages (с публичным API):
```html
<script>
  window.API_URL = 'https://api.yourdomain.com'; // Ваш API сервер
</script>
```

### GitHub Pages (с ngrok для тестирования):
```html
<script>
  window.API_URL = 'https://abc123.ngrok.io/pc_salon'; // ngrok URL
</script>
```

